---
layout:     post
title:      PLB SIGCOMM 2022
subtitle:   Congestion Signals are Simple and Effective for Network Load Balancing
date:       2022-09-10
author:     Yiran
header-img: img/post-bg-deer.jpg
catalog: true
tags:
    - Load Balancing
---

Google的网络负载均衡方案(在[FlowBender](https://conferences2.sigcomm.org/co-next/2014/CoNEXT_papers/p149.pdf)基础上，实际大规模部署的方案)

### Motivation

**现实中的hot spot:** 

<img width="450" height="350" src="/img/post-plb-1.png"/>

**Obliviously spreading traffic?**  flowlet是[17年思科提出的想法](https://www.usenix.org/system/files/conference/nsdi17/nsdi17-vanini.pdf)，(交换机)对网络中自动出现的flowlet随机撒，但发现并不能使流量更加均衡，只是位置上变换了过载和低载的链路

<img width="450" height="250" src="/img/post-plb-7.png"/>

### PLB

PLB增强了Flowbender两个架构上的问题：

**1. 使用Ipv6 Flow label来repath**: 交换机ECMP加上Ipv6 Flow label，非常容易部署

**2. PLB repath after idle periods**: defer repathing a congested flow until it becomes idle(假设small RPCs on long lasting TCP connections), 避免了乱序等与CC交互的问题。同时充分利用CC本身的拥塞探测能力。

具体包括两个核心算法：**congstion detection** 和 **re-pathing**

<img width="400" height="800" src="/img/post-plb-2.png"/>

<img width="400" height="300" src="/img/post-plb-3.png"/>

``亮点：与congestion control interaction 的考虑与分析``： When a flow experiences congestion, PLB waits several round trips (configured by $M$ , $N$ in Algorithm 2) before repathing. This gives congestion control time to react to transient issues. If PLB were to repath immediately, then congestion control would become an open-loop, with every round-trip potentially measuring a different path. Similarly, PLB prefers to repath after idle, at the start of an application duty cycle. Congestion state is likely stale at this time and probing is already required to acquire fresh state. On the other hand, we do not want to endure prolonged heavy congestion (i.e. large $N$ , $K$ in Algorithm 1). This could lower performance as congestion control may slow the flows down instead of PLB seeking more available bandwidth.


### PLB IN PRODUCTION

[代码](https://github.com/google/plb.)

LI: $max$−$min$ utilization over the switch ports

<img width="450" height="300" src="/img/post-plb-4.png"/>

<img width="450" height="800" src="/img/post-plb-5.png"/>

<img width="450" height="350" src="/img/post-plb-6.png"/>



### Thinking

Load Balancing 是前几年 (12\~18年左右）相对较热的topic, 学术界提出了各式的方案，基于网络内Switch的[CONGA](https://people.csail.mit.edu/alizadeh/papers/conga-sigcomm14.pdf)/[LetFlow](https://www.usenix.org/system/files/conference/nsdi17/nsdi17-vanini.pdf)/[Drill](https://pbg.cs.illinois.edu/papers/ghorbani17drill.pdf)/[HULA](https://conferences.sigcomm.org/sosr/2016/papers/sosr_paper67.pdf)/[Vertigo](http://soudeh.net/files/vertigo_conext21.pdf)，基于controller集中调度的[Hedera](https://raghavan.usc.edu/papers/hedera-nsdi10.pdf)/[MicroTE](https://dl.acm.org/doi/10.1145/2079296.2079304)，基于边缘主机或者软件层的[FlowBender](https://conferences2.sigcomm.org/co-next/2014/CoNEXT_papers/p149.pdf)/[Presto](https://conferences.sigcomm.org/sigcomm/2015/pdf/papers/p465.pdf)/[RPS](https://ieeexplore.ieee.org/document/6567015)/[Clove](https://www.cs.princeton.edu/~jrex/papers/clove17.pdf)，修改主机协议栈的[MPTCP](https://www.multipath-tcp.org/)等等，PLB这篇论文从工业界的视角，介绍了在实际部署中的尝试和发现，认为更加务实的随机repath具有良好的效果。

>Solutions that are simple and general will always have a strong value proposition because of the combination of reduced costs with broad applicability  



### 参考文献

[PLB:Congestion Signals are Simple and Effective for Network Load Balancing](https://dl.acm.org/doi/10.1145/3544216.3544226)
